<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Emotion Music Player 🎵</title>
</head>
<body>
  <h2>Emotion Based Music Player 🎧</h2>

  <!-- Login -->
  <button id="loginBtn">Login with Spotify</button>
  <p id="status"></p>

  <!-- Emoji Buttons -->
  <div>
    <button class="emoji" data-playlist="37i9dQZF1DXdPec7aLTmlC">😄 Happy</button>
    <button class="emoji" data-playlist="37i9dQZF1DWX83CujKHHOn">😢 Sad</button>
    <button class="emoji" data-playlist="37i9dQZF1DX76Wlfdnj7AP">😡 Angry</button>
    <button class="emoji" data-playlist="37i9dQZF1DX4WYpdgoIcn6">😌 Relax</button>
  </div>

  <script>
    const clientId = "c4ae87d2c2124350875c8a4059c6d452"; // tamaru clientId
    const redirectUri = "https://harpalsinh888.github.io/emotion-base-music-player-/callback"; // tamaru URI
    const scopes = "user-read-playback-state user-modify-playback-state streaming";

    // Spotify Login
    document.getElementById("loginBtn").onclick = () => {
      const authUrl = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${encodeURIComponent(scopes)}`;
      window.location.href = authUrl;
    };

    // Token extract karo
    const hash = window.location.hash.substring(1).split("&").reduce((initial, item) => {
      if (item) {
        let parts = item.split("=");
        initial[parts[0]] = decodeURIComponent(parts[1]);
      }
      return initial;
    }, {});

    if (hash.access_token) {
      localStorage.setItem("spotifyToken", hash.access_token);
      document.getElementById("status").innerText = "✅ Logged in!";
      window.location.hash = "";
    }

    const token = localStorage.getItem("spotifyToken");

    // Playlist play karvanu
    async function playPlaylist(playlistId) {
      if (!token) {
        alert("Please login first!");
        return;
      }

      const res = await fetch("https://api.spotify.com/v1/me/player/devices", {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      const deviceId = data.devices[0]?.id;

      if (!deviceId) {
        alert("No active device found. Open Spotify app on your PC/Mobile.");
        return;
      }

      await fetch(`https://api.spotify.com/v1/me/player/play?device_id=${deviceId}`, {
        method: "PUT",
        body: JSON.stringify({ context_uri: `spotify:playlist:${playlistId}` }),
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
      });

      alert("🎶 Playing playlist...");
    }

    document.querySelectorAll(".emoji").forEach(btn => {
      btn.addEventListener("click", () => {
        const playlist = btn.getAttribute("data-playlist");
        playPlaylist(playlist);
      });
    });
  </script>
</body>
</html>
